{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/ad/index.vue?vue&type=style&index=0&id=31b22200&lang=less&scoped=true&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/ad/index.vue","mtime":1658454377432},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/loaders/stylePostLoader.js","mtime":1655715156000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js","mtime":1657523213663},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CkBpbXBvcnQgdXJsKCIuL2luZGV4Lmxlc3MiKTsKLm5hdmlnYXRpb24gewogIC9kZWVwLy52YW4tbmF2LWJhciB7CiAgICB6LWluZGV4OiA5OTk5OwogIH0KfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAsXA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/ad","sourcesContent":["<template>\n  <P-main>\n    <Navigation\n      title=\"我的广告\"\n      :left-arrow=\"false\"\n      :class=\"[bool.ScreeningClass ? 'navigation' : '']\"\n    >\n      <template #right>\n        <B-svg name=\"shaixuan\" @click=\"openScreening(true)\" />\n      </template>\n    </Navigation>\n    <P-body type=\"Fei\">\n      <!-- <P-list\n        ref=\"P-list\"\n        :footer=\"true\"\n        theme=\"card\"\n        @refresh=\"onRefresh\"\n        @load=\"onList\"\n      >\n        <template v-slot=\"{ row }\">\n          <B-a :href=\"`/advertisingfordetails/${row.id}`\">\n            <Advertising-list\n              :name=\"row.name\"\n              :Price=\"row.Price\"\n              :badge=\"row.number\"\n              :date=\"row.datetime\"\n              :state=\"row.number\"\n              @operation=\"operation(row)\"\n            />\n          </B-a>\n        </template>\n      </P-list> -->\n      <div class=\"adv-list-parent\">\n        <van-pull-refresh v-model=\"loading\" @refresh=\"onRefresh\">\n          <ul class=\"adv-list\">\n            <li\n              v-for=\"(row, index) in advList\"\n              :key=\"index\"\n              :class=\"row.adv_type == 2 ? 'green-color' : 'red-color'\"\n            >\n              <!-- 标题信息 -->\n              <div class=\"adv-title\">\n                <p class=\"title-msg\">\n                  <span></span>{{ row.adv_type == 2 ? \"购买\" : \"出售\" }}&nbsp;{{\n                    row.coin\n                  }}\n                </p>\n                <div>\n                  <span>{{ row.status_text }}</span>\n                  <van-switch\n                    v-if=\"row.status == 1 || row.status == 2\"\n                    active-color=\"#2CBC94\"\n                    inactive-color=\"#ccc\"\n                    v-model=\"row.checked\"\n                    @change=\"upAdvStatusEv(row)\"\n                    size=\"16\"\n                  />\n                </div>\n              </div>\n              <!-- 广告信息 -->\n              <div class=\"adv-content\">\n                <div class=\"price-msg\">\n                  <p>\n                    <span>数量</span>{{ row.amount.toFixed(2) }}&nbsp;{{\n                      row.coin\n                    }}\n                  </p>\n                  <p>\n                    <span>限额</span>{{ row.min_currency.toFixed(2) }}-{{\n                      row.max_currency.toFixed(2)\n                    }}&nbsp;{{ row.currency }}\n                  </p>\n                </div>\n                <div class=\"price-limit\">\n                  <p>单价</p>\n                  <p class=\"with-color\">\n                    <span>{{ row.currency_symbol }}</span\n                    >{{ row.price.toFixed(2) }}\n                  </p>\n                </div>\n              </div>\n              <!-- 操作信息 -->\n              <div class=\"adv-footer\">\n                <div class=\"pay-way\">\n                  <p v-for=\"(pay, index) in row.payments\" :key=\"index\">\n                    <img :src=\"pay.logo\" alt=\"\" />\n                  </p>\n                </div>\n                <div class=\"iconfont icon-qita\" @click=\"operation(row)\"></div>\n              </div>\n            </li>\n          </ul>\n          <infinite-loading\n            spinner=\"spiral\"\n            @infinite=\"loadMoreEvent\"\n            :distance=\"0\"\n          >\n            <div slot=\"spinner\">\n              <mt-spinner type=\"triple-bounce\" color=\"#2CBC94\"></mt-spinner>\n            </div>\n          </infinite-loading>\n        </van-pull-refresh>\n      </div>\n    </P-body>\n    <Screening v-model=\"bool.Screening\" @click=\"getFilter\" />\n    <P-select\n      v-model=\"bool.moreAndMore\"\n      :list=\"select\"\n      cancelText=\"取消\"\n      @select=\"moreOperations\"\n    />\n    <Alert\n      type=\"typography\"\n      @click=\"upAdvStatusEv(null, advID)\"\n      v-model=\"bool.closeTheAd\"\n      title=\"确认关闭广告?\"\n    >\n      若您已向卖家付款，请勿取消订单，否则可能会导致资金损失。若当日取消超过3次将会禁止交易。\n    </Alert>\n    <P-suspension-add @click=\"goRelease\" />\n    <!-- 申请成为商家 -->\n    <Alert\n      title=\"提示\"\n      v-model=\"bool.goChant\"\n      @click=\"$router.push('/chant-application')\"\n    >\n      <p class=\"text-center\">您尚未成为商家，是否前往申请？</p>\n    </Alert>\n    <!-- 设置昵称 -->\n    <Alert\n      v-model=\"bool.setNickName\"\n      title=\"设置昵称\"\n      @click=\"submitNickname\"\n      btnDetermineName=\"添加\"\n    >\n      <div class=\"set-nickname\">\n        <p>\n          <span class=\"iconfont icon-attention\"></span>\n          发布广告需设置法币账户昵称，完成设置后不可修改。\n        </p>\n        <input type=\"text\" placeholder=\"请输入昵称\" v-model=\"nickname\" />\n      </div>\n    </Alert>\n  </P-main>\n</template>\n\n<script>\nimport AdvertisingList from \"@/components/advertising-list\";\nimport Screening from \"./components/screening\";\nimport { mapState } from \"vuex\";\nimport { SetNickname, AdvList, Types, UpAdvStatus } from \"../../api/api\";\nimport InfiniteLoading from \"vue-infinite-loading\";\nexport default {\n  components: {\n    AdvertisingList,\n    Screening,\n    InfiniteLoading,\n  },\n  data() {\n    return {\n      bool: {\n        ScreeningClass: false,\n        Screening: false,\n        ScreeningBool: true,\n        moreAndMore: false,\n        closeTheAd: false,\n        goChant: false,\n        setNickName: false,\n      },\n      nickname: \"\",\n      select: [{ name: \"修改\" }, { name: \"关闭广告\", color: \"#FD5656\" }],\n      advList: [], //广告列表\n      advListSec: [],\n      page: 0,\n      loading: false,\n      advID: null,\n      arr2: [],\n      arr3: [],\n      arr4: [],\n    };\n  },\n  watch: {\n    \"bool.Screening\"(v) {\n      if (!v) {\n        this.openScreening(false);\n      }\n    },\n  },\n  computed: {\n    ...mapState([\"current\"]),\n    \n  },\n  created() {\n    // this.getFilterAdv();\n    // this.getAdvList();\n  },\n  mounted() {},\n  methods: {\n    //筛选类型\n    getFilter(_params) {\n      console.log(_params);\n      // let arr = this.advList;\n      // let arr2 = [],arr3 = [],arr4 = [];\n      let arr2 = [];\n      if (_params != \"全部\") {\n        arr2 = this.advListSec.filter((item) => {\n          return (\n            item.type_text.includes(_params) || item.coin.includes(_params)\n          );\n        });\n      }\n      this.advList = arr2;\n      console.log(this.advList);\n      if (_params.coin != \"全部\") {\n        arr3 = this.advListSec.filter((item) => {\n          return item.coin.includes(_params.coin);\n        });\n      }\n      if (_params.status != \"全部\") {\n        arr4 = this.advListSec.filter((item) => {\n          return item.status_text.includes(_params.status);\n        });\n      }\n      [\n        //{ title: \"\", coin: \"\", status: \"\" },\n        { title: \"\", coin: \"\", status: \"\" },\n        //{ title: \"\", coin: \"\", status: \"\" },\n      ];\n      return;\n      this.bool.Screening = false;\n    },\n    //获取广告列表\n    async getAdvList() {\n      const result = await AdvList({ page: this.page, limit: 10 });\n      const types = await Types({ scene: \"AdsStatus\" });\n      if (this.page > 1) {\n        result.data.list.forEach((e) => {\n          this.advList.push(e);\n        });\n      } else {\n        this.advList = result.data.list;\n      }\n      this.advList.forEach((e) => {\n        this.$set(e, \"checked\", e.status == 1 ? true : false);\n        this.$set(e, \"type_text\", e.type == 1 ? \"出售\" : \"购买\");\n        types.data.map.forEach((type) => {\n          if (e.status == type.val) {\n            this.$set(e, \"status_text\", type.name);\n          }\n        });\n      });\n      this.advListSec = this.advList;\n      this.arr2 = this.advList;\n      this.arr3 = this.advList;\n      this.arr4 = this.advList;\n      return result;\n    },\n    async loadMoreEvent($state) {\n      //   this.state = $state;\n      //   this.loadMoreDom = true;\n      this.page += 1;\n      const result = await this.getAdvList();\n      const { data } = result;\n      if (this.advList.length == data.total) {\n        $state.complete();\n      } else {\n        $state.loaded();\n      }\n    },\n    //更新广告状态\n    async upAdvStatusEv(_row, _status) {\n      const params = {\n        id: _status ? _status : _row.id,\n        status: _status ? 3 : _row.status == 1 ? 2 : 1,\n      };\n      const result = await UpAdvStatus(params);\n      const { code } = result;\n      if (code != 200) {\n        this.$toast(result.message);\n        return;\n      }\n      this.$toast.success({\n        message: \"修改成功\",\n        forbidClick: true,\n      });\n      this.getAdvList();\n      this.bool.closeTheAd = false;\n    },\n    openScreening(bool) {\n      if (this.bool.ScreeningBool) {\n        this.bool.ScreeningBool = false;\n        if (this.bool.ScreeningClass) {\n          if (bool) {\n            this.bool.Screening = !this.bool.Screening;\n          }\n          setTimeout(() => {\n            this.bool.ScreeningClass = false;\n            this.bool.ScreeningBool = true;\n          }, 500);\n        } else {\n          this.bool.ScreeningClass = true;\n          setTimeout(() => {\n            if (bool) {\n              this.bool.Screening = !this.bool.Screening;\n            }\n            this.bool.ScreeningBool = true;\n          }, 50);\n        }\n      }\n    },\n    operation(row) {\n      this.bool.moreAndMore = true;\n      this.advID = row.id;\n    },\n    moreOperations(action, index) {\n      if (index === 1) {\n        this.bool.closeTheAd = true;\n      }\n    },\n    async onList() {\n      const response = await API.GetData(this, \"api/list\");\n      const { code, items, total } = response;\n      if (code == 200) {\n        this.$refs[\"P-list\"].Add(items, total);\n      }\n    },\n    onRefresh() {\n      // this.onList();\n      this.page = 0;\n      this.getAdvList();\n      setTimeout(() => {\n        this.loading = false;\n      }, 500);\n    },\n    //发布广告\n    goRelease() {\n      //  href=\"/release\"/\n      if (!this.current.account.security) {\n        this.$router.push(\"/login?ReturnUrl=/\");\n        return;\n      }\n      const { merchant } = this.current.account.security;\n      const { merchant_name } = this.current.account.merchantInfo;\n      if (merchant == 0) {\n        this.bool.goChant = true;\n        return;\n      }\n      if (!merchant_name) {\n        this.bool.setNickName = true;\n        return;\n      }\n      this.$router.push(\"/release\");\n    },\n    //设置昵称\n    async submitNickname() {\n      if (!this.nickname) {\n        this.$toast(\"请输入昵称\");\n        return;\n      }\n      const result = await SetNickname({ merchant_name: this.nickname });\n      const { code } = result;\n      if (code != 200) {\n        this.$toast(result.message);\n        return;\n      }\n      await this.$store.dispatch(\"current/upUserInfo\");\n      this.$toast(\"设置成功\");\n      this.$router.push(\"/release\");\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n@import url(\"./index.less\");\n.navigation {\n  /deep/.van-nav-bar {\n    z-index: 9999;\n  }\n}\n</style>"]}]}