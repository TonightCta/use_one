{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/login/index.vue?vue&type=style&index=0&id=37dfd6fc&lang=less&scoped=true&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/login/index.vue","mtime":1658305676811},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/loaders/stylePostLoader.js","mtime":1655715156000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js","mtime":1657523213663},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5lbWFpbCB7CiAgICBoZWlnaHQ6IDIwcHg7CiAgICBmb250LXNpemU6IDE0cHg7CiAgICBjb2xvcjogIzJjYmM5NDsKfQoKLmxvZ2luIHsKICAgIC50aGVOYXRpb25hbEZsYWcgewogICAgICAgIGhlaWdodDogMTVweDsKICAgICAgICB3aWR0aDogMTVweDsKICAgIH0KICAgIC51c2VyLWxlZnQgewogICAgICAgIC5qaWFuVG91WGlhIHsKICAgICAgICAgICAgd2lkdGg6IDEzcHg7CiAgICAgICAgICAgIGhlaWdodDogMTNweDsKICAgICAgICAgICAgZmlsbDogIzJjYmM5NDsKICAgICAgICB9CiAgICAgICAgLm5hbWUgewogICAgICAgICAgICBjb2xvcjogIzJjYmM5NDsKICAgICAgICAgICAgbWFyZ2luOiAwcHggM3B4OwogICAgICAgIH0KICAgIH0KfQoKLnJlZ2lzdGVyZWQgewogICAgZm9udC1zaXplOiAxNHB4OwogICAgY29sb3I6ICM5OTk5OTk7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAuKA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/login","sourcesContent":["<!--\n * @Name: 登录\n * @Date: 2022-06-25 20:38:13\n * @LastEditors: VSCode\n * @LastEditTime: 2022-07-04 20:12:25\n-->\n<template>\n    <div>\n        <P-main class=\"login\" v-show=\"!bool.SelectArea\">\n            <Navigation :languageSwitch=\"true\" />\n            <h3>{{$t('密码登录')}}</h3>\n            <el-form :model=\"form\" ref=\"form\" :rules=\"rules\" label-position=\"top\">\n                <el-form-item prop=\"phone\" v-if=\"!email\">\n                    <P-input :title=\"$t('手机')\" :iconBorder=\"true\" v-model=\"form.phone\" :placeholder=\"$t('请输入手机号码')\">\n                        <template #more>\n                            <div class=\"email\" @click=\"switchEmail(true)\">{{$t('邮箱登录')}}</div>\n                        </template>\n                        <template #icon>\n                            <div slot='icon'>\n                                <div class=\"user-left ui-flex-row\" @click=\"bool.SelectArea = true\">\n                                    <div v-if=\"form.phone_prefix\"><img :src=\"NationalNumber.logo\"\n                                            class=\"theNationalFlag\">\n                                    </div>\n                                    <div v-if=\"form.phone_prefix\" class=\"name\">{{form.phone_prefix}}</div>\n                                    <div v-if=\"!form.phone_prefix\" class=\"ui-col-fei m-5-r\">{{$t('请选择')}}</div>\n                                    <B-svg name=\"jianTouXia\" class-name=\"jianTouXia\" />\n                                </div>\n                            </div>\n                        </template>\n                    </P-input>\n                </el-form-item>\n\n                <el-form-item prop=\"email\" v-if=\"email\">\n                    <P-input :title=\"$t('邮箱')\" v-model=\"form.email\" icon=\"icon-youxiang\" :placeholder=\"$t('请输入邮箱')\">\n                        <template #more>\n                            <div class=\"email\" @click=\"switchEmail(false)\">{{$t('手机登录')}}</div>\n                        </template>\n                    </P-input>\n                </el-form-item>\n\n                <el-form-item prop=\"password\">\n                    <P-input :title=\"$t('密码')\" v-model=\"form.password\" icon=\"icon-suoding\" :show-password=\"true\"\n                        :placeholder=\"$t('输入您的登录密码')\" />\n                </el-form-item>\n            </el-form>\n            <P-button type=\"primary\" class=\"btn-primary h-44-i m-60-t-i\" @click=\"onSubmit('form')\">{{$t('登录')}}\n            </P-button>\n\n            <div class=\"registered ui-flex-center m-15-t\">\n                <B-a href=\"/registered\">{{$t('注册账号')}}</B-a>\n                <B-a href=\"/forgotpassword\">{{$t('忘记密码')}}?</B-a>\n            </div>\n        </P-main>\n        <SelectArea v-model=\"bool.SelectArea\" @click=\"onSelectArea\"  @close-area=\"closeArea\"/>\n    </div>\n</template>\n\n<script>\nimport SelectArea from './components/selectArea';\nimport { UserInfo } from '../../api/api'\n\nexport default {\n    components: { SelectArea },\n    data() {\n        const validationPhone = (rule, value, callback) => {\n            if (this.form.phone_prefix == '') {\n                callback(new Error(this.$t('请选择国家区号')));\n            }else {\n               callback()\n            }\n            // }\n        }\n\n        return {\n            bool: {\n                SelectArea: false\n            },\n            NationalNumber: {\n                logo: ''\n            },\n            email: false,\n            form: {\n                phone_prefix: '',\n                phone: '',\n                email: '',\n                password: ''\n            },\n            rules: {\n                phone: [\n                    { required: true, message: this.$t('请输入手机号码'), trigger: 'blur' },\n                    { validator: validationPhone, trigger: 'blur' }\n                ],\n                email: [\n                    { required: true, message: this.$t('请输入邮箱'), trigger: 'blur' },\n                    { validator: new RegExp().email, trigger: 'blur' }\n                ],\n                password: [\n                    { required: true, message: this.$t('请输入密码'), trigger: 'blur' },\n                    { min: 8, max: 12, message: this.$t('长度在8到12个字符'), trigger: 'blur' },\n                    { validator: new RegExp().password, trigger: 'blur' }\n                ]\n            },\n            ReturnUrl: '/index'\n        }\n    },\n    watch: {\n        '$route.query': {\n            immediate: true,\n            handler: function (v) {\n                if (v.ReturnUrl) {\n                    this.ReturnUrl = v.ReturnUrl\n                }\n            }\n        },\n    },\n    methods: {\n        closeArea(){\n            this.bool.SelectArea = false;\n        },  \n        switchEmail(bool) {\n            this.email = bool\n            this.$refs['form'].resetFields();\n        },\n        onSelectArea(row) {\n            this.NationalNumber = row\n            this.form.phone_prefix = row.prefix\n        },\n        onSubmit(formName) {\n            this.$refs[formName].validate((res) => {\n                if (res) {\n                    this.onLogin()\n                }\n            });\n        },\n        async onLogin() {\n            this.$toast.loading({\n                duration: 0,\n                forbidClick: true,\n                message: '登录中'\n            });\n\n            const response = await this.$store.dispatch('users/login', {\n                account: this.email ? this.form.email : this.form.phone,\n                password: this.form.password\n            })\n\n            this.$toast.clear();\n\n            if (response.code == 200) {\n                const result = await UserInfo(response.data.access_token);\n                const { code,data } = result;\n                console.log(code)\n                if(code != 200){\n                    this.$toast('登录异常，请稍后再试');\n                    router.currentRoute\n                };\n                this.$store.commit('current/upAccount',data)\n                this.$router.push({\n                    path: this.ReturnUrl\n                })\n            }\n        }\n    }\n};\n</script>\n\n<style lang=\"less\" scoped>\n.email {\n    height: 20px;\n    font-size: 14px;\n    color: #2cbc94;\n}\n\n.login {\n    .theNationalFlag {\n        height: 15px;\n        width: 15px;\n    }\n    .user-left {\n        .jianTouXia {\n            width: 13px;\n            height: 13px;\n            fill: #2cbc94;\n        }\n        .name {\n            color: #2cbc94;\n            margin: 0px 3px;\n        }\n    }\n}\n\n.registered {\n    font-size: 14px;\n    color: #999999;\n}\n</style>"]}]}