{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/google_auth.vue?vue&type=style&index=0&id=0f722d1a&lang=less&scoped=true&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/google_auth.vue","mtime":1658282915471},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/loaders/stylePostLoader.js","mtime":1655715156000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_less-loader@4.1.0@less-loader/dist/cjs.js","mtime":1657523213663},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5nb29nbGUtY29udGVudCB7CiAgd2lkdGg6IDEwMCU7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlNmU2ZTY7CiAgcGFkZGluZzogMjhweCAxMnB4OwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gNDZweCk7CiAgLnN0ZXAtcmVtYXJrIHsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIGNvbG9yOiAjMzMzOwogICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgIG1hcmdpbi1ib3R0b206IDE0cHg7CiAgfQogIC5zdGVwLW9uZSB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgLnN0ZXAtY29uIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHAgewogICAgICAgIG1hcmdpbi1ib3R0b206IDRweDsKICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgY29sb3I6ICM2NjY7CiAgICAgIH0KICAgICAgLmxvYWQtd2F5IHsKICAgICAgICB3aWR0aDogMTI2cHg7CiAgICAgICAgaGVpZ2h0OiAzOHB4OwogICAgICAgIGJvcmRlci1yYWRpdXM6IDdweDsKICAgICAgICBiYWNrZ3JvdW5kOiBibGFjazsKICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgIC5iZy1pbWd7CiAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICB9CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIC5zbWFsbC1iZ3sKICAgICAgICAgIHdpZHRoOiAxOHB4OwogICAgICAgICAgaGVpZ2h0OiAyMHB4OwogICAgICAgICAgbWFyZ2luOjAgOHB4OwogICAgICAgIH0KICAgICAgICBwewogICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgLnFyLWJveCB7CiAgICB3aWR0aDogMTM1cHg7CiAgICBoZWlnaHQ6IDEzNXB4OwogICAgcGFkZGluZzogNHB4OwogICAgaW1nIHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGhlaWdodDogMTAwJTsKICAgIH0KICB9CiAgLnFyLXRleHQgewogICAgZGlzcGxheTogZmxleDsKICAgIG1hcmdpbi10b3A6IDEwcHg7CiAgICAudGV4dC1ib3ggewogICAgICBoZWlnaHQ6IDM0cHg7CiAgICAgIGZsZXg6IDE7CiAgICAgIGJhY2tncm91bmQ6ICNmOGY4Zjg7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIHBhZGRpbmctbGVmdDogOHB4OwogICAgICBmb250LXNpemU6IDEzcHg7CiAgICAgIGNvbG9yOiAjNjY2OwogICAgICBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgIG1hcmdpbi1yaWdodDogMTJweDsKICAgIH0KICAgIGJ1dHRvbiB7CiAgICAgIGhlaWdodDogMzRweDsKICAgICAgYmFja2dyb3VuZDogIzJjYmM5NDsKICAgICAgYm9yZGVyLXJhZGl1czogNHB4OwogICAgfQogICAgYnV0dG9uOmxhc3QtY2hpbGQgewogICAgICBtYXJnaW4tbGVmdDogNnB4OwogICAgfQogIH0KICAuc3RlcC1wYXNzIHsKICAgIGlucHV0IHsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIGhlaWdodDogMzRweDsKICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7CiAgICB9CiAgfQp9Ci5yZW1vdmUtYXV0aCB7CiAgcGFkZGluZzogMTJweDsKICAvZGVlcC8uZWwtZm9ybS1pdGVtIHsKICAgIG1hcmdpbi1ib3R0b206IDZweDsKICB9CiAgLmJ0bi1wcmltYXJ5IHsKICAgIG1hcmdpbi10b3A6IDQwcHg7CiAgfQp9Cg=="},{"version":3,"sources":["google_auth.vue"],"names":[],"mappings":";AA6PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"google_auth.vue","sourceRoot":"src/views/mine/safty","sourcesContent":["<!-- Google验证器 -->\n<template>\n  <div class=\"google-auth\">\n    <Navigation :title=\"gooleType == 1 ? '设置谷歌认证' : '解除谷歌绑定'\" />\n    <div class=\"google-content\" v-if=\"gooleType == 1\">\n      <div>\n        <p class=\"step-remark\">\n          第一步：根据您的手机系统类型，下载并安装谷歌身份验证器\n        </p>\n        <div class=\"step-one\">\n          <div class=\"step-con\" v-for=\"(down, index) in downWay\" :key=\"index\">\n            <p>{{ down.type }}</p>\n            <div\n              class=\"load-way\"\n              v-for=\"(load, index) in down.way\"\n              :key=\"`${index}-load`\"\n              @click=\"moveToPlay(load.url)\"\n            >\n              <img  v-if=\"!load.icon\" class=\"bg-img\" :src=\"load.bg\" alt=\"\">\n              <img :src=\"load.bg\" v-else class=\"small-bg\" alt=\"\">\n              <p v-if=\"load.icon\">Android</p>\n            </div> \n          </div>\n        </div>\n        <p class=\"step-remark\" style=\"margin-top: 20px\">\n          第二步：使用谷歌身份认证器APP扫描一下二维码，或添加密文进行手工验证\n        </p>\n        <div class=\"qr-box\" ref=\"auth-code\">\n          <!-- <img :src=\"require('../../../assets/images/test.png')\" alt=\"\" /> -->\n        </div>\n        <div class=\"qr-text\">\n          <p class=\"text-box\">密文：{{ googleCode }}</p>\n          <P-copy :value=\"googleCode\">\n            <P-button type=\"primary\">复制</P-button>\n          </P-copy>\n          <P-button type=\"primary\">刷新</P-button>\n        </div>\n        <p class=\"step-remark\" style=\"margin-top: 28px\">\n          第三步：填写手机显示的动态密码以激活谷歌两步验证：\n        </p>\n        <p class=\"step-pass\">\n          <input\n            type=\"text\"\n            v-model=\"authCodeLocal\"\n            placeholder=\"请输入动态密码\"\n          />\n        </p>\n      </div>\n      <div>\n        <P-button\n          type=\"primary\"\n          class=\"btn-primary h-44-i m-60-t-i\"\n          @click=\"enableAuth\"\n          >启用</P-button\n        >\n      </div>\n    </div>\n    <!-- 解除验证器 -->\n    <div class=\"remove-auth\" v-else>\n      <el-form\n        :model=\"form\"\n        ref=\"removeAuth\"\n        :rules=\"ruleForm\"\n        label-position=\"top\"\n      >\n        <el-form-item prop=\"password\">\n          <P-input\n            title=\"登录密码\"\n            v-model=\"form.password\"\n            :show-password=\"true\"\n            placeholder=\"请输入登录密码\"\n          ></P-input>\n        </el-form-item>\n        <el-form-item prop=\"authCode\">\n          <P-input\n            title=\"谷歌验证码\"\n            v-model=\"form.authCode\"\n            placeholder=\"请输入谷歌验证码\"\n          ></P-input>\n        </el-form-item>\n      </el-form>\n      <P-button\n        type=\"primary\"\n        class=\"btn-primary\"\n        @click=\"submitRemove('removeAuth')\"\n        >确认</P-button\n      >\n    </div>\n    <Alert\n      title=\"提示\"\n      @click=\"$router.go(-1)\"\n      v-model=\"removeStatus\"\n      :cancelSwitch=\"false\"\n    >\n      <p style=\"text-align: center\">谷歌认证解除成功</p>\n    </Alert>\n  </div>\n</template>\n\n<script>\nimport { GoogleAuthMsg, BindGoogleAuth,UnBindGoogleAuth } from \"../../../api/api\";\nimport QRCode from \"qrcodejs2\";\nimport { mapState } from \"vuex\";\nexport default {\n  data() {\n    return {\n      gooleType: 1, //1 - 设置 2 - 解除\n      removeStatus: false,\n      downWay: [\n        {\n          type: \"Android：\",\n          way: [\n            {\n              type: \"local\",\n              url: 'https://www.baidu.com',\n              icon:true,\n              bg:require('../../../assets/images/and_logo.png'),\n            },\n            {\n              type: \"play\",\n              url: 'https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2',\n              icon:false,\n              bg:require('../../../assets/images/google_down.png'),\n            },\n          ],\n        },\n        {\n          type: \"iOS：\",\n          way: [\n            {\n              type: \"store\",\n              url: 'itms-apps://itunes.apple.com/app/id388497605?action=write-review',\n              icon:false,\n              bg: require('../../../assets/images/ios_down.png'),\n            },\n          ],\n        },\n      ],\n      form: {\n        password: \"\",\n        authCode: \"\",\n      },\n      ruleForm: {\n        password: [\n          {\n            required: true,\n            message: this.$t(\"请输入登录密码\"),\n            trigger: \"blur\",\n          },\n        ],\n        authCode: [\n          {\n            required: true,\n            message: this.$t(\"请输入谷歌验证码\"),\n            trigger: \"blur\",\n          },\n        ],\n      },\n      googleCode: null, //谷歌验证器代码\n      qrCode: null, //谷歌验证器二维码\n      authCodeLocal: null, //用户谷歌验证码\n    };\n  },\n  computed:{\n    ...mapState(['current'])\n  },\n  components: {\n    Navigation: (resolve) =>\n      require([\"../../../components/nav/Navigation\"], resolve),\n    Alert: (resolve) => require([\"../../../components/Alert\"], resolve),\n  },\n  created() {\n    this.gooleType = this.current.account.security.ga == 1 ? 2 : 1\n    this.current.account.security.ga != 1 && this.getGoogleMsg();\n  },\n  // mounted(){\n  //   this.$nextTick(() => {\n  //     this.createQRCode();\n  //   })\n  // },\n  watch: {\n    qrCode(val) {\n      val && this.createQRCode();\n    },\n  },\n  methods: {\n    submitRemove(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          const params = {\n            code:this.form.authCode,\n            password:this.form.password\n          };\n          const result = await UnBindGoogleAuth(params);\n          console.log(result);\n          const { code } = result;\n          if(code == 200){\n            this.removeStatus = true;\n            this.$store.dispatch('current/upUserInfo')\n          }else{\n            this.$toast.fail(result.message)\n          }\n          console.log(\"验证通过\");\n        }\n      });\n    },\n    //Google Play https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2\n    //获取谷歌验证器信息\n    async getGoogleMsg() {\n      const result = await GoogleAuthMsg();\n      this.googleCode = result.data.secret;\n      this.qrCode = result.data.qrcode;\n    },\n    //生成二维码\n    createQRCode() {\n      new QRCode(this.$refs[\"auth-code\"], {\n        text: this.qrCode,\n        width: 128,\n        height: 128,\n        colorDark: \"#333\",\n        colorLight: \"#fff\",\n        correctLevel: QRCode.CorrectLevel.L,\n      });\n    },\n    //启用谷歌验证器\n    async enableAuth() {\n      if (!this.authCodeLocal) {\n        this.$toast(\"请输入动态密码\");\n        return;\n      }\n      if(this.authCodeLocal.length != 6){\n        this.$toast(\"请输入六位谷歌动态密码\");\n        return;\n      }\n      const result = await BindGoogleAuth({ code: this.authCodeLocal });\n      console.log(result);\n      const { code } = result;\n      if (code == 200) {\n        this.$toast.success(\"谷歌验证器启用成功\");\n        this.$store.dispatch(\"current/upUserInfo\");\n        this.$router.go(-1);\n      }else{\n        this.$toast.fail(result.message)\n      }\n    },\n    moveToPlay(_url){\n      window.open(_url)\n    }\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n.google-content {\n  width: 100%;\n  border-top: 1px solid #e6e6e6;\n  padding: 28px 12px;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  height: calc(100vh - 46px);\n  .step-remark {\n    font-size: 14px;\n    color: #333;\n    font-weight: 500;\n    margin-bottom: 14px;\n  }\n  .step-one {\n    display: flex;\n    .step-con {\n      width: 100%;\n      p {\n        margin-bottom: 4px;\n        font-size: 14px;\n        color: #666;\n      }\n      .load-way {\n        width: 126px;\n        height: 38px;\n        border-radius: 7px;\n        background: black;\n        margin-bottom: 10px;\n        .bg-img{\n          width: 100%;\n          height: 100%;\n        }\n        display: flex;\n        align-items: center;\n        .small-bg{\n          width: 18px;\n          height: 20px;\n          margin:0 8px;\n        }\n        p{\n          font-size: 14px;\n          font-weight: 500;\n          color: white;\n        }\n      }\n    }\n  }\n  .qr-box {\n    width: 135px;\n    height: 135px;\n    padding: 4px;\n    img {\n      width: 100%;\n      height: 100%;\n    }\n  }\n  .qr-text {\n    display: flex;\n    margin-top: 10px;\n    .text-box {\n      height: 34px;\n      flex: 1;\n      background: #f8f8f8;\n      display: flex;\n      align-items: center;\n      padding-left: 8px;\n      font-size: 13px;\n      color: #666;\n      border-radius: 4px;\n      margin-right: 12px;\n    }\n    button {\n      height: 34px;\n      background: #2cbc94;\n      border-radius: 4px;\n    }\n    button:last-child {\n      margin-left: 6px;\n    }\n  }\n  .step-pass {\n    input {\n      width: 100%;\n      height: 34px;\n      border-bottom: 1px solid #eee;\n    }\n  }\n}\n.remove-auth {\n  padding: 12px;\n  /deep/.el-form-item {\n    margin-bottom: 6px;\n  }\n  .btn-primary {\n    margin-top: 40px;\n  }\n}\n</style>"]}]}