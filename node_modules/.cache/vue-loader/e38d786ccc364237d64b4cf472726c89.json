{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue","mtime":1658713050076},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CmltcG9ydCB7IFRvYXN0IH0gZnJvbSAidmFudCI7CmltcG9ydCB7IGNoZWNrUGFzc3dvcmQgfSBmcm9tICIuLi8uLi8uLi91dGlscy9pbmRleCI7CmltcG9ydCB7IFNlbmRDb2RlLCBWZXJpZnlDb2RlLCBTZXRUcmFkZVBhc3MgfSBmcm9tICIuLi8uLi8uLi9hcGkvYXBpIjsKaW1wb3J0IHsgbWFwU3RhdGUgfSBmcm9tICJ2dWV4IjsKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICBjb25zdCB2ZXJpZnlfcGFzcyA9IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgaWYgKCFjaGVja1Bhc3N3b3JkKHZhbHVlKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi5a+G56CB5qC85byP5Li6OC0xMuS9jeWkp+WGmeOAgeWwj+WGmeiLseaWh+Wtl+avjeWPiuaVsOWtl+e7hOWQiCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9OwogICAgY29uc3QgdmVyaWZ5X3JlcGVhdCA9IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLmZvcm0ucGFzc3dvcmQpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoIuS4pOasoei+k+WFpeWvhueggeS4jeS4gOiHtCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgc3RhdHVzOiAwLAogICAgICBpc19iaW5kX3Bob25lOiB0cnVlLCAvL+aYr+WQpue7keWumuaJi+acuuWPtwogICAgICBpc0JpbmRQaG9uZTogZmFsc2UsIC8v5pyq57uR5a6a5o+Q56S6CiAgICAgIHZhbEJlZm9yZTogIiIsIC8v5YmN572u6aqM6K+B56CBCiAgICAgIGNvdW50OiAwLCAvL+mqjOivgeeggeWAkuiuoeaXtgogICAgICBjb2RlTG9jYWw6IG51bGwsCiAgICAgIGZvcm06IHsKICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgcmVwZWF0OiAiIiwKICAgICAgfSwKICAgICAgcnVsZUZvcm06IHsKICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgewogICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgi6K+36L6T5YWl5Lqk5piT5a+G56CBIiksCiAgICAgICAgICAgIHRyaWdnZXI6ICJibHVyIiwKICAgICAgICAgIH0sCiAgICAgICAgICB7IHZhbGlkYXRvcjogdmVyaWZ5X3Bhc3MsIHRyaWdnZXI6ICJibHVyIiB9LAogICAgICAgIF0sCiAgICAgICAgcmVwZWF0OiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCLor7flho3mrKHovpPlhaXkuqTmmJPlr4bnoIEiKSwKICAgICAgICAgICAgdHJpZ2dlcjogImJsdXIiLAogICAgICAgICAgfSwKICAgICAgICAgIHsgdmFsaWRhdG9yOiB2ZXJpZnlfcmVwZWF0LCB0cmlnZ2VyOiAiYmx1ciIgfSwKICAgICAgICBdLAogICAgICB9LAogICAgICByZW1hcmtMaXN0OiBbCiAgICAgICAgIuS6pOaYk+WvhueggeaYr+WcqOS6pOaYk+aJgOi/m+ihjOS6pOaYk+aXtumcgOimgei+k+WFpeWvhuegge+8jOS4jeWQjOS4jueZu+W9leWvhueggeOAguS4uuehruS/neaCqOeahOi0ouS6p+WuieWFqO+8jOivt+eJouiusOS6pOaYk+Wvhuegge+8jOmYsuatouS4ouWkseOAgiIsCiAgICAgICAgIjgtMTLkvY3lkKvlpKflsI/lhpnlrZfmr43lj4rmlbDlrZfjgIIiLAogICAgICBdLAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBTdGF0ZShbImN1cnJlbnQiXSksCiAgfSwKICB3YXRjaDogewogICAgdmFsQmVmb3JlKHZhbCkgewogICAgICBpZiAodmFsLmxlbmd0aCA9PSA2KSB7CiAgICAgICAgY29uc3QgbmV4dCA9IGFzeW5jICgpID0+IHsKICAgICAgICAgIFRvYXN0LmxvYWRpbmcoewogICAgICAgICAgICBtZXNzYWdlOiAi5Yqg6L295LitLi4uIiwKICAgICAgICAgICAgZm9yYmlkQ2xpY2s6IHRydWUsCiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgc2NlbmU6IDQsCiAgICAgICAgICAgIHJlY2VpdmVyOiB0aGlzLmN1cnJlbnQuYWNjb3VudC5waG9uZSwKICAgICAgICAgICAgY29kZTogdmFsLAogICAgICAgICAgfTsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFZlcmlmeUNvZGUocGFyYW1zKTsKICAgICAgICAgIGNvbnN0IHsgY29kZSB9ID0gcmVzdWx0OwogICAgICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0KHJlc3VsdC5tZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5zdGF0dXMgPSAxOwogICAgICAgICAgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAvLyB9LCAyMDAwKTsKICAgICAgICB9OwogICAgICAgIG5leHQoKTsKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICAhdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmUgJiYgKHRoaXMuaXNCaW5kUGhvbmUgPSB0cnVlKTsKICAgIHRoaXMuY3VycmVudC5hY2NvdW50LnBob25lICYmIHRoaXMuc2VuZEF1dGhDb2RlKCk7CiAgfSwKICBjb21wb25lbnRzOiB7CiAgICBOYXZpZ2F0aW9uOiAocmVzb2x2ZSkgPT4KICAgICAgcmVxdWlyZShbIi4uLy4uLy4uL2NvbXBvbmVudHMvbmF2L05hdmlnYXRpb24iXSwgcmVzb2x2ZSksCiAgICBBbGVydDogKHJlc29sdmUpID0+IHJlcXVpcmUoWyIuLi8uLi8uLi9jb21wb25lbnRzL0FsZXJ0Il0sIHJlc29sdmUpLAogIH0sCiAgbWV0aG9kczogewogICAgc3VibWl0U2V0KGZvcm1OYW1lKSB7CiAgICAgIHRoaXMuJHJlZnNbZm9ybU5hbWVdLnZhbGlkYXRlKGFzeW5jIChyZXMpID0+IHsKICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi6aqM6K+B6YCa6L+HIik7CiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIGNvZGU6IHRoaXMudmFsQmVmb3JlLAogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5mb3JtLnBhc3N3b3JkLAogICAgICAgICAgICBwYXNzd29yZF9jb25maXJtYXRpb246IHRoaXMuZm9ybS5yZXBlYXQsCiAgICAgICAgICB9OwogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgU2V0VHJhZGVQYXNzKHBhcmFtcyk7CiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpOwogICAgICAgICAgY29uc3QgeyBjb2RlIH0gPSByZXN1bHQ7CiAgICAgICAgICBpZiAoY29kZSAhPSAyMDApIHsKICAgICAgICAgICAgdGhpcy4kdG9hc3QocmVzdWx0Lm1lc3NhZ2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLiR0b2FzdC5zdWNjZXNzKCLkuqTmmJPlr4bnoIHorr7nva7miJDlip8iKTsKICAgICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCJjdXJyZW50L3VwVXNlckluZm8iKTsKICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICAvL+WPkemAgemqjOivgemqjOivgeeggQogICAgYXN5bmMgc2VuZEF1dGhDb2RlKCkgewogICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgc2NlbmU6IDQsCiAgICAgICAgdHlwZTogdGhpcy5jdXJyZW50LmFjY291bnQudHlwZSwKICAgICAgICBlbWFpbDogdGhpcy5jdXJyZW50LmFjY291bnQuZW1haWwsCiAgICAgICAgcGhvbmU6IHRoaXMuY3VycmVudC5hY2NvdW50LnBob25lLAogICAgICAgIHBob25lX3ByZWZpeDogdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmVfcHJlZml4LAogICAgICB9OwogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTZW5kQ29kZShwYXJhbXMpOwogICAgICBjb25zdCB7IGNvZGUgfSA9IHJlc3VsdDsKICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgdGhpcy4kdG9hc3QuZmFpbChyZXN1bHQubWVzc2FnZSk7CiAgICAgICAgdGhpcy5jb3VudCA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb3VudCA9IDYwOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["trade_auth.vue"],"names":[],"mappings":";AA0EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"trade_auth.vue","sourceRoot":"src/views/mine/safty","sourcesContent":["<template>\n  <div class=\"trade-auth\">\n    <Navigation />\n    <!-- 前置验证 -->\n    <div class=\"trade-before-auth\" v-if=\"status == 0\">\n      <h3>{{ current.account.type == 1 ? \"手机\" : \"邮箱\" }}验证码</h3>\n      <p class=\"before-remark\">为保护您的账号安全，需要登录密码进行验证</p>\n      <P-verification v-model=\"valBefore\" />\n      <p v-if=\"count == 0\" @click=\"sendAuthCode()\" class=\"send-code un-send\">\n        获取验证码\n      </p>\n      <B-data-theCountdown v-model=\"count\" v-else class=\"send-code\"\n        >{{ count }} {{ $t(\"秒后重新获取\") }}</B-data-theCountdown\n      >\n    </div>\n    <div class=\"set-trade-password\" v-else>\n      <h3>\n        {{\n          current.account.security.pay_password == 1 ? \"修改\" : \"设置\"\n        }}交易密码\n      </h3>\n      <p class=\"before-remark\">8-12位大写、小写英文字母及数字组合</p>\n      <div class=\"form-box\">\n        <el-form\n          ref=\"form\"\n          :model=\"form\"\n          :rules=\"ruleForm\"\n          label-position=\"top\"\n        >\n          <el-form-item prop=\"password\">\n            <P-input\n              title=\"交易密码\"\n              v-model=\"form.password\"\n              :show-password=\"true\"\n              placeholder=\"请输入交易密码\"\n            ></P-input>\n          </el-form-item>\n          <el-form-item prop=\"repeat\">\n            <P-input\n              v-model=\"form.repeat\"\n              title=\"确认密码\"\n              :show-password=\"true\"\n              placeholder=\"请再次输入交易密码\"\n            ></P-input>\n          </el-form-item>\n        </el-form>\n        <!-- 交易密码说明 -->\n        <div class=\"trade-remark-box\">\n          <ul>\n            <li v-for=\"(remark, index) in remarkList\" :key=\"`${index}-remark`\">\n              <p class=\"remark-point\"></p>\n              <p>{{ remark }}</p>\n            </li>\n          </ul>\n        </div>\n        <P-button type=\"primary\" class=\"btn-primary\" @click=\"submitSet('form')\"\n          >立即设置</P-button\n        >\n      </div>\n    </div>\n    <Alert\n      svg=\"\"\n      type=\"typography\"\n      title=\"提示\"\n      v-model=\"isBindPhone\"\n      @cancel=\"$router.go(-1)\"\n      @click=\"$router.push('/auth-phone')\"\n    >\n      <p>设置交易密码前需要手机认证</p>\n    </Alert>\n  </div>\n</template>\n\n<script>\nimport { Toast } from \"vant\";\nimport { checkPassword } from \"../../../utils/index\";\nimport { SendCode, VerifyCode, SetTradePass } from \"../../../api/api\";\nimport { mapState } from \"vuex\";\nexport default {\n  data() {\n    const verify_pass = (rule, value, callback) => {\n      if (!checkPassword(value)) {\n        callback(new Error(\"密码格式为8-12位大写、小写英文字母及数字组合\"));\n      } else {\n        callback();\n      }\n    };\n    const verify_repeat = (rule, value, callback) => {\n      if (value !== this.form.password) {\n        callback(new Error(\"两次输入密码不一致\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      status: 0,\n      is_bind_phone: true, //是否绑定手机号\n      isBindPhone: false, //未绑定提示\n      valBefore: \"\", //前置验证码\n      count: 0, //验证码倒计时\n      codeLocal: null,\n      form: {\n        password: \"\",\n        repeat: \"\",\n      },\n      ruleForm: {\n        password: [\n          {\n            required: true,\n            message: this.$t(\"请输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_pass, trigger: \"blur\" },\n        ],\n        repeat: [\n          {\n            required: true,\n            message: this.$t(\"请再次输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_repeat, trigger: \"blur\" },\n        ],\n      },\n      remarkList: [\n        \"交易密码是在交易所进行交易时需要输入密码，不同与登录密码。为确保您的财产安全，请牢记交易密码，防止丢失。\",\n        \"8-12位含大小写字母及数字。\",\n      ],\n    };\n  },\n  computed: {\n    ...mapState([\"current\"]),\n  },\n  watch: {\n    valBefore(val) {\n      if (val.length == 6) {\n        const next = async () => {\n          Toast.loading({\n            message: \"加载中...\",\n            forbidClick: true,\n          });\n          const params = {\n            scene: 4,\n            receiver: this.current.account.phone,\n            code: val,\n          };\n          const result = await VerifyCode(params);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.status = 1;\n          // setTimeout(() => {\n          // }, 2000);\n        };\n        next();\n      }\n    },\n  },\n  created() {\n    !this.current.account.phone && (this.isBindPhone = true);\n    this.current.account.phone && this.sendAuthCode();\n  },\n  components: {\n    Navigation: (resolve) =>\n      require([\"../../../components/nav/Navigation\"], resolve),\n    Alert: (resolve) => require([\"../../../components/Alert\"], resolve),\n  },\n  methods: {\n    submitSet(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          console.log(\"验证通过\");\n          const params = {\n            code: this.valBefore,\n            password: this.form.password,\n            password_confirmation: this.form.repeat,\n          };\n          const result = await SetTradePass(params);\n          console.log(result);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.$toast.success(\"交易密码设置成功\");\n          this.$store.dispatch(\"current/upUserInfo\");\n          this.$router.go(-1);\n        }\n      });\n    },\n    //发送验证验证码\n    async sendAuthCode() {\n      const params = {\n        scene: 4,\n        type: this.current.account.type,\n        email: this.current.account.email,\n        phone: this.current.account.phone,\n        phone_prefix: this.current.account.phone_prefix,\n      };\n      const result = await SendCode(params);\n      const { code } = result;\n      if (code != 200) {\n        this.$toast.fail(result.message);\n        this.count = 0;\n      } else {\n        this.count = 60;\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\nh3 {\n  font-size: 22px;\n  color: #333;\n  font-weight: 500;\n}\n.before-remark {\n  font-size: 12px;\n  color: #999;\n  margin-top: 8px;\n  margin-bottom: 40px;\n}\n.trade-before-auth {\n  padding: 30px 12px;\n\n  .send-code {\n    text-align: right;\n    margin-top: 14px;\n    font-size: 14px;\n  }\n  .un-send {\n    color: #2cbc94;\n  }\n}\n.set-trade-password {\n  padding: 30px 12px;\n  /deep/.el-form-item {\n    margin-bottom: 4px;\n  }\n  .trade-remark-box {\n    padding: 12px;\n    background: #eee;\n    border-radius: 4px;\n    margin-top: 22px;\n    ul {\n      li {\n        display: flex;\n        align-items: center;\n        .remark-point {\n          min-width: 5px;\n          height: 5px;\n          border-radius: 50%;\n          background: #999;\n          margin-right: 8px;\n        }\n        p:last-child {\n          font-size: 12px;\n          color: #999;\n        }\n      }\n      li:last-child {\n        margin-top: 12px;\n      }\n    }\n  }\n  .btn-primary {\n    margin-top: 22px;\n  }\n}\n</style>"]}]}