{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js!/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--1-0!/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue","mtime":1658285568629},{"path":"/Users/tql_yy/Documents/code/use_one/babel.config.js","mtime":1657511087035},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgeyBUb2FzdCB9IGZyb20gInZhbnQiOwppbXBvcnQgeyBjaGVja1Bhc3N3b3JkIH0gZnJvbSAiLi4vLi4vLi4vdXRpbHMvaW5kZXgiOwppbXBvcnQgeyBTZW5kQ29kZSwgVmVyaWZ5Q29kZSwgU2V0VHJhZGVQYXNzIH0gZnJvbSAiLi4vLi4vLi4vYXBpL2FwaSI7CmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAidnVleCI7CmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgY29uc3QgdmVyaWZ5X3Bhc3MgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICghY2hlY2tQYXNzd29yZCh2YWx1ZSkpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoIuWvhueggeagvOW8j+S4ujgtMTLkvY3lpKflhpnjgIHlsI/lhpnoi7HmloflrZfmr43lj4rmlbDlrZfnu4TlkIgiKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbGJhY2soKTsKICAgICAgfQogICAgfTsKCiAgICBjb25zdCB2ZXJpZnlfcmVwZWF0ID0gKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgPT4gewogICAgICBpZiAodmFsdWUgIT09IHRoaXMuZm9ybS5wYXNzd29yZCkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi5Lik5qyh6L6T5YWl5a+G56CB5LiN5LiA6Ie0IikpOwogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH07CgogICAgcmV0dXJuIHsKICAgICAgc3RhdHVzOiAwLAogICAgICBpc19iaW5kX3Bob25lOiB0cnVlLAogICAgICAvL+aYr+WQpue7keWumuaJi+acuuWPtwogICAgICBpc0JpbmRQaG9uZTogZmFsc2UsCiAgICAgIC8v5pyq57uR5a6a5o+Q56S6CiAgICAgIHZhbEJlZm9yZTogIiIsCiAgICAgIC8v5YmN572u6aqM6K+B56CBCiAgICAgIGNvdW50OiAwLAogICAgICAvL+mqjOivgeeggeWAkuiuoeaXtgogICAgICBjb2RlTG9jYWw6IG51bGwsCiAgICAgIGZvcm06IHsKICAgICAgICBwYXNzd29yZDogIiIsCiAgICAgICAgcmVwZWF0OiAiIgogICAgICB9LAogICAgICBydWxlRm9ybTogewogICAgICAgIHBhc3N3b3JkOiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCLor7fovpPlhaXkuqTmmJPlr4bnoIEiKSwKICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgIH0sIHsKICAgICAgICAgIHZhbGlkYXRvcjogdmVyaWZ5X3Bhc3MsCiAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICB9XSwKICAgICAgICByZXBlYXQ6IFt7CiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoIuivt+WGjeasoei+k+WFpeS6pOaYk+WvhueggSIpLAogICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgfSwgewogICAgICAgICAgdmFsaWRhdG9yOiB2ZXJpZnlfcmVwZWF0LAogICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgfV0KICAgICAgfSwKICAgICAgcmVtYXJrTGlzdDogWyLkuqTmmJPlr4bnoIHmmK/lnKjkuqTmmJPmiYDov5vooYzkuqTmmJPml7bpnIDopoHovpPlhaXlr4bnoIHvvIzkuI3lkIzkuI7nmbvlvZXlr4bnoIHjgILkuLrnoa7kv53mgqjnmoTotKLkuqflronlhajvvIzor7fniaLorrDkuqTmmJPlr4bnoIHvvIzpmLLmraLkuKLlpLHjgIIiLCAiOC0xMuS9jeWQq+Wkp+Wwj+WGmeWtl+avjeWPiuaVsOWtl+OAgiJdCiAgICB9OwogIH0sCgogIGNvbXB1dGVkOiB7IC4uLm1hcFN0YXRlKFsiY3VycmVudCJdKQogIH0sCiAgd2F0Y2g6IHsKICAgIHZhbEJlZm9yZSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGggPT0gNikgewogICAgICAgIGNvbnN0IG5leHQgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICBUb2FzdC5sb2FkaW5nKHsKICAgICAgICAgICAgbWVzc2FnZTogIuWKoOi9veS4rS4uLiIsCiAgICAgICAgICAgIGZvcmJpZENsaWNrOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgc2NlbmU6IDQsCiAgICAgICAgICAgIHJlY2VpdmVyOiB0aGlzLmN1cnJlbnQuYWNjb3VudC5waG9uZSwKICAgICAgICAgICAgY29kZTogdmFsCiAgICAgICAgICB9OwogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgVmVyaWZ5Q29kZShwYXJhbXMpOwogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBjb2RlCiAgICAgICAgICB9ID0gcmVzdWx0OwoKICAgICAgICAgIGlmIChjb2RlICE9IDIwMCkgewogICAgICAgICAgICB0aGlzLiR0b2FzdChyZXN1bHQubWVzc2FnZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnN0YXR1cyA9IDE7IC8vIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gfSwgMjAwMCk7CiAgICAgICAgfTsKCiAgICAgICAgbmV4dCgpOwogICAgICB9CiAgICB9CgogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICAhdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmUgJiYgKHRoaXMuaXNCaW5kUGhvbmUgPSB0cnVlKTsKICAgIHRoaXMuY3VycmVudC5hY2NvdW50LnBob25lICYmIHRoaXMuc2VuZEF1dGhDb2RlKCk7CiAgfSwKCiAgY29tcG9uZW50czogewogICAgTmF2aWdhdGlvbjogcmVzb2x2ZSA9PiByZXF1aXJlKFsiLi4vLi4vLi4vY29tcG9uZW50cy9uYXYvTmF2aWdhdGlvbiJdLCByZXNvbHZlKSwKICAgIEFsZXJ0OiByZXNvbHZlID0+IHJlcXVpcmUoWyIuLi8uLi8uLi9jb21wb25lbnRzL0FsZXJ0Il0sIHJlc29sdmUpCiAgfSwKICBtZXRob2RzOiB7CiAgICBzdWJtaXRTZXQoZm9ybU5hbWUpIHsKICAgICAgdGhpcy4kcmVmc1tmb3JtTmFtZV0udmFsaWRhdGUoYXN5bmMgcmVzID0+IHsKICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi6aqM6K+B6YCa6L+HIik7CiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIGNvZGU6IHRoaXMudmFsQmVmb3JlLAogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5mb3JtLnBhc3N3b3JkLAogICAgICAgICAgICBwYXNzd29yZF9jb25maXJtYXRpb246IHRoaXMuZm9ybS5yZXBlYXQKICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBTZXRUcmFkZVBhc3MocGFyYW1zKTsKICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNvZGUKICAgICAgICAgIH0gPSByZXN1bHQ7CgogICAgICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0KHJlc3VsdC5tZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuJHRvYXN0LnN1Y2Nlc3MoIuS6pOaYk+Wvhueggeiuvue9ruaIkOWKnyIpOwogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImN1cnJlbnQvdXBVc2VySW5mbyIpOwogICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvL+WPkemAgemqjOivgemqjOivgeeggQogICAgYXN5bmMgc2VuZEF1dGhDb2RlKCkgewogICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgc2NlbmU6IDQsCiAgICAgICAgdHlwZTogdGhpcy5jdXJyZW50LmFjY291bnQudHlwZSwKICAgICAgICBlbWFpbDogdGhpcy5jdXJyZW50LmFjY291bnQuZW1haWwsCiAgICAgICAgcGhvbmU6IHRoaXMuY3VycmVudC5hY2NvdW50LnBob25lLAogICAgICAgIHBob25lX3ByZWZpeDogdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmVfcHJlZml4CiAgICAgIH07CiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFNlbmRDb2RlKHBhcmFtcyk7CiAgICAgIGNvbnN0IHsKICAgICAgICBjb2RlCiAgICAgIH0gPSByZXN1bHQ7CgogICAgICBpZiAoY29kZSAhPSAyMDApIHsKICAgICAgICB0aGlzLiR0b2FzdC5mYWlsKHJlc3VsdC5tZXNzYWdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmNvdW50ID0gNjA7CiAgICAgIH0KICAgIH0KCiAgfQp9Ow=="},{"version":3,"mappings":";AA0EA;AACA;AACA;AACA;AACA;EACAA;IACA;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACA;QACAA;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACAC,SADA;MAEAC,mBAFA;MAEA;MACAC,kBAHA;MAGA;MACAC,aAJA;MAIA;MACAC,QALA;MAKA;MACAC,eANA;MAOAC;QACAC,YADA;QAEAC;MAFA,CAPA;MAWAC;QACAF,WACA;UACAG,cADA;UAEAC,2BAFA;UAGAC;QAHA,CADA,EAMA;UAAAC;UAAAD;QAAA,CANA,CADA;QASAJ,SACA;UACAE,cADA;UAEAC,6BAFA;UAGAC;QAHA,CADA,EAMA;UAAAC;UAAAD;QAAA,CANA;MATA,CAXA;MA6BAE,aACA,sDADA,EAEA,iBAFA;IA7BA;EAkCA,CAlDA;;EAmDAC,YACA;EADA,CAnDA;EAsDAC;IACAb;MACA;QACA;UACAc;YACAN,iBADA;YAEAO;UAFA;UAIA;YACAC,QADA;YAEAC,oCAFA;YAGAC;UAHA;UAKA;UACA;YAAAA;UAAA;;UACA;YACA;YACA;UACA;;UACA,gBAhBA,CAiBA;UACA;QACA,CAnBA;;QAoBAC;MACA;IACA;;EAzBA,CAtDA;;EAiFAC;IACA;IACA;EACA,CApFA;;EAqFAC;IACAC,uBACAC,wDAFA;IAGAC;EAHA,CArFA;EA0FAC;IACAC;MACA;QACA;UACAC;UACA;YACAT,oBADA;YAEAd,4BAFA;YAGAwB;UAHA;UAKA;UACAD;UACA;YAAAT;UAAA;;UACA;YACA;YACA;UACA;;UACA;UACA;UACA;QACA;MACA,CAnBA;IAoBA,CAtBA;;IAuBA;IACA;MACA;QACAF,QADA;QAEAa,+BAFA;QAGAC,iCAHA;QAIAC,iCAJA;QAKAC;MALA;MAOA;MACA;QAAAd;MAAA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA;;EAvCA;AA1FA","names":["data","callback","status","is_bind_phone","isBindPhone","valBefore","count","codeLocal","form","password","repeat","ruleForm","required","message","trigger","validator","remarkList","computed","watch","Toast","forbidClick","scene","receiver","code","next","created","components","Navigation","require","Alert","methods","submitSet","console","password_confirmation","type","email","phone","phone_prefix"],"sourceRoot":"src/views/mine/safty","sources":["trade_auth.vue"],"sourcesContent":["<template>\n  <div class=\"trade-auth\">\n    <Navigation />\n    <!-- 前置验证 -->\n    <div class=\"trade-before-auth\" v-if=\"status == 0\">\n      <h3>{{ current.account.type == 1 ? \"手机\" : \"邮箱\" }}验证码</h3>\n      <p class=\"before-remark\">为保护您的账号安全，需要登录密码进行验证</p>\n      <P-verification v-model=\"valBefore\" />\n      <p v-if=\"count == 0\" @click=\"sendAuthCode()\" class=\"send-code un-send\">\n        获取验证码\n      </p>\n      <B-data-theCountdown v-model=\"count\" v-else class=\"send-code\"\n        >{{ count }} {{ $t(\"秒后重新获取\") }}</B-data-theCountdown\n      >\n    </div>\n    <div class=\"set-trade-password\" v-else>\n      <h3>\n        {{\n          current.account.security.pay_password == 1 ? \"修改\" : \"设置\"\n        }}交易密码\n      </h3>\n      <p class=\"before-remark\">8-12位大写、小写英文字母及数字组合</p>\n      <div class=\"form-box\">\n        <el-form\n          ref=\"form\"\n          :model=\"form\"\n          :rules=\"ruleForm\"\n          label-position=\"top\"\n        >\n          <el-form-item prop=\"password\">\n            <P-input\n              title=\"交易密码\"\n              v-model=\"form.password\"\n              :show-password=\"true\"\n              placeholder=\"请输入交易密码\"\n            ></P-input>\n          </el-form-item>\n          <el-form-item prop=\"repeat\">\n            <P-input\n              v-model=\"form.repeat\"\n              title=\"确认密码\"\n              :show-password=\"true\"\n              placeholder=\"请再次输入交易密码\"\n            ></P-input>\n          </el-form-item>\n        </el-form>\n        <!-- 交易密码说明 -->\n        <div class=\"trade-remark-box\">\n          <ul>\n            <li v-for=\"(remark, index) in remarkList\" :key=\"`${index}-remark`\">\n              <p class=\"remark-point\"></p>\n              <p>{{ remark }}</p>\n            </li>\n          </ul>\n        </div>\n        <P-button type=\"primary\" class=\"btn-primary\" @click=\"submitSet('form')\"\n          >立即设置</P-button\n        >\n      </div>\n    </div>\n    <Alert\n      svg=\"\"\n      type=\"typography\"\n      title=\"提示\"\n      v-model=\"isBindPhone\"\n      @cancel=\"$router.go(-1)\"\n      @click=\"$router.push('/auth-phone')\"\n    >\n      <p>设置交易密码前需要手机认证</p>\n    </Alert>\n  </div>\n</template>\n\n<script>\nimport { Toast } from \"vant\";\nimport { checkPassword } from \"../../../utils/index\";\nimport { SendCode, VerifyCode, SetTradePass } from \"../../../api/api\";\nimport { mapState } from \"vuex\";\nexport default {\n  data() {\n    const verify_pass = (rule, value, callback) => {\n      if (!checkPassword(value)) {\n        callback(new Error(\"密码格式为8-12位大写、小写英文字母及数字组合\"));\n      } else {\n        callback();\n      }\n    };\n    const verify_repeat = (rule, value, callback) => {\n      if (value !== this.form.password) {\n        callback(new Error(\"两次输入密码不一致\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      status: 0,\n      is_bind_phone: true, //是否绑定手机号\n      isBindPhone: false, //未绑定提示\n      valBefore: \"\", //前置验证码\n      count: 0, //验证码倒计时\n      codeLocal: null,\n      form: {\n        password: \"\",\n        repeat: \"\",\n      },\n      ruleForm: {\n        password: [\n          {\n            required: true,\n            message: this.$t(\"请输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_pass, trigger: \"blur\" },\n        ],\n        repeat: [\n          {\n            required: true,\n            message: this.$t(\"请再次输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_repeat, trigger: \"blur\" },\n        ],\n      },\n      remarkList: [\n        \"交易密码是在交易所进行交易时需要输入密码，不同与登录密码。为确保您的财产安全，请牢记交易密码，防止丢失。\",\n        \"8-12位含大小写字母及数字。\",\n      ],\n    };\n  },\n  computed: {\n    ...mapState([\"current\"]),\n  },\n  watch: {\n    valBefore(val) {\n      if (val.length == 6) {\n        const next = async () => {\n          Toast.loading({\n            message: \"加载中...\",\n            forbidClick: true,\n          });\n          const params = {\n            scene: 4,\n            receiver: this.current.account.phone,\n            code: val,\n          };\n          const result = await VerifyCode(params);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.status = 1;\n          // setTimeout(() => {\n          // }, 2000);\n        };\n        next();\n      }\n    },\n  },\n  created() {\n    !this.current.account.phone && (this.isBindPhone = true);\n    this.current.account.phone && this.sendAuthCode();\n  },\n  components: {\n    Navigation: (resolve) =>\n      require([\"../../../components/nav/Navigation\"], resolve),\n    Alert: (resolve) => require([\"../../../components/Alert\"], resolve),\n  },\n  methods: {\n    submitSet(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          console.log(\"验证通过\");\n          const params = {\n            code: this.valBefore,\n            password: this.form.password,\n            password_confirmation: this.form.repeat,\n          };\n          const result = await SetTradePass(params);\n          console.log(result);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.$toast.success(\"交易密码设置成功\");\n          this.$store.dispatch(\"current/upUserInfo\");\n          this.$router.go(-1);\n        }\n      });\n    },\n    //发送验证验证码\n    async sendAuthCode() {\n      const params = {\n        scene: 4,\n        type: this.current.account.type,\n        email: this.current.account.email,\n        phone: this.current.account.phone,\n        phone_prefix: this.current.account.phone_prefix,\n      };\n      const result = await SendCode(params);\n      const { code } = result;\n      if (code != 200) {\n        this.$toast.fail(result.message);\n      } else {\n        this.count = 60;\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\nh3 {\n  font-size: 22px;\n  color: #333;\n  font-weight: 500;\n}\n.before-remark {\n  font-size: 12px;\n  color: #999;\n  margin-top: 8px;\n  margin-bottom: 40px;\n}\n.trade-before-auth {\n  padding: 30px 12px;\n\n  .send-code {\n    text-align: right;\n    margin-top: 14px;\n    font-size: 14px;\n  }\n  .un-send {\n    color: #2cbc94;\n  }\n}\n.set-trade-password {\n  padding: 30px 12px;\n  /deep/.el-form-item {\n    margin-bottom: 4px;\n  }\n  .trade-remark-box {\n    padding: 12px;\n    background: #eee;\n    border-radius: 4px;\n    margin-top: 22px;\n    ul {\n      li {\n        display: flex;\n        align-items: center;\n        .remark-point {\n          min-width: 5px;\n          height: 5px;\n          border-radius: 50%;\n          background: #999;\n          margin-right: 8px;\n        }\n        p:last-child {\n          font-size: 12px;\n          color: #999;\n        }\n      }\n      li:last-child {\n        margin-top: 12px;\n      }\n    }\n  }\n  .btn-primary {\n    margin-top: 22px;\n  }\n}\n</style>"]}]}