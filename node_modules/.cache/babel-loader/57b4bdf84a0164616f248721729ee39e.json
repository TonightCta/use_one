{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js!/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--1-0!/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/trade_auth.vue","mtime":1658285568629},{"path":"/Users/tql_yy/Documents/code/use_one/babel.config.js","mtime":1657511087035},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiKTsKCnZhciBfdmFudCA9IHJlcXVpcmUoInZhbnQiKTsKCnZhciBfaW5kZXggPSByZXF1aXJlKCIuLi8uLi8uLi91dGlscy9pbmRleCIpOwoKdmFyIF9hcGkgPSByZXF1aXJlKCIuLi8uLi8uLi9hcGkvYXBpIik7Cgp2YXIgX3Z1ZXggPSByZXF1aXJlKCJ2dWV4Iik7Cgp2YXIgX2RlZmF1bHQgPSB7CiAgZGF0YSgpIHsKICAgIGNvbnN0IHZlcmlmeV9wYXNzID0gKHJ1bGUsIHZhbHVlLCBjYWxsYmFjaykgPT4gewogICAgICBpZiAoISgwLCBfaW5kZXguY2hlY2tQYXNzd29yZCkodmFsdWUpKSB7CiAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCLlr4bnoIHmoLzlvI/kuLo4LTEy5L2N5aSn5YaZ44CB5bCP5YaZ6Iux5paH5a2X5q+N5Y+K5pWw5a2X57uE5ZCIIikpOwogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH07CgogICAgY29uc3QgdmVyaWZ5X3JlcGVhdCA9IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgaWYgKHZhbHVlICE9PSB0aGlzLmZvcm0ucGFzc3dvcmQpIHsKICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoIuS4pOasoei+k+WFpeWvhueggeS4jeS4gOiHtCIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIHN0YXR1czogMCwKICAgICAgaXNfYmluZF9waG9uZTogdHJ1ZSwKICAgICAgLy/mmK/lkKbnu5HlrprmiYvmnLrlj7cKICAgICAgaXNCaW5kUGhvbmU6IGZhbHNlLAogICAgICAvL+acque7keWumuaPkOekugogICAgICB2YWxCZWZvcmU6ICIiLAogICAgICAvL+WJjee9rumqjOivgeeggQogICAgICBjb3VudDogMCwKICAgICAgLy/pqozor4HnoIHlgJLorqHml7YKICAgICAgY29kZUxvY2FsOiBudWxsLAogICAgICBmb3JtOiB7CiAgICAgICAgcGFzc3dvcmQ6ICIiLAogICAgICAgIHJlcGVhdDogIiIKICAgICAgfSwKICAgICAgcnVsZUZvcm06IHsKICAgICAgICBwYXNzd29yZDogW3sKICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgi6K+36L6T5YWl5Lqk5piT5a+G56CBIiksCiAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICB9LCB7CiAgICAgICAgICB2YWxpZGF0b3I6IHZlcmlmeV9wYXNzLAogICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgfV0sCiAgICAgICAgcmVwZWF0OiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCLor7flho3mrKHovpPlhaXkuqTmmJPlr4bnoIEiKSwKICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgIH0sIHsKICAgICAgICAgIHZhbGlkYXRvcjogdmVyaWZ5X3JlcGVhdCwKICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgIH1dCiAgICAgIH0sCiAgICAgIHJlbWFya0xpc3Q6IFsi5Lqk5piT5a+G56CB5piv5Zyo5Lqk5piT5omA6L+b6KGM5Lqk5piT5pe26ZyA6KaB6L6T5YWl5a+G56CB77yM5LiN5ZCM5LiO55m75b2V5a+G56CB44CC5Li656Gu5L+d5oKo55qE6LSi5Lqn5a6J5YWo77yM6K+354mi6K6w5Lqk5piT5a+G56CB77yM6Ziy5q2i5Lii5aSx44CCIiwgIjgtMTLkvY3lkKvlpKflsI/lhpnlrZfmr43lj4rmlbDlrZfjgIIiXQogICAgfTsKICB9LAoKICBjb21wdXRlZDogeyAuLi4oMCwgX3Z1ZXgubWFwU3RhdGUpKFsiY3VycmVudCJdKQogIH0sCiAgd2F0Y2g6IHsKICAgIHZhbEJlZm9yZSh2YWwpIHsKICAgICAgaWYgKHZhbC5sZW5ndGggPT0gNikgewogICAgICAgIGNvbnN0IG5leHQgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICBfdmFudC5Ub2FzdC5sb2FkaW5nKHsKICAgICAgICAgICAgbWVzc2FnZTogIuWKoOi9veS4rS4uLiIsCiAgICAgICAgICAgIGZvcmJpZENsaWNrOiB0cnVlCiAgICAgICAgICB9KTsKCiAgICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICAgIHNjZW5lOiA0LAogICAgICAgICAgICByZWNlaXZlcjogdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmUsCiAgICAgICAgICAgIGNvZGU6IHZhbAogICAgICAgICAgfTsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0ICgwLCBfYXBpLlZlcmlmeUNvZGUpKHBhcmFtcyk7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNvZGUKICAgICAgICAgIH0gPSByZXN1bHQ7CgogICAgICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0KHJlc3VsdC5tZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuc3RhdHVzID0gMTsgLy8gc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAvLyB9LCAyMDAwKTsKICAgICAgICB9OwoKICAgICAgICBuZXh0KCk7CiAgICAgIH0KICAgIH0KCiAgfSwKCiAgY3JlYXRlZCgpIHsKICAgICF0aGlzLmN1cnJlbnQuYWNjb3VudC5waG9uZSAmJiAodGhpcy5pc0JpbmRQaG9uZSA9IHRydWUpOwogICAgdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmUgJiYgdGhpcy5zZW5kQXV0aENvZGUoKTsKICB9LAoKICBjb21wb25lbnRzOiB7CiAgICBOYXZpZ2F0aW9uOiByZXNvbHZlID0+IHJlcXVpcmUoWyIuLi8uLi8uLi9jb21wb25lbnRzL25hdi9OYXZpZ2F0aW9uIl0sIHJlc29sdmUpLAogICAgQWxlcnQ6IHJlc29sdmUgPT4gcmVxdWlyZShbIi4uLy4uLy4uL2NvbXBvbmVudHMvQWxlcnQiXSwgcmVzb2x2ZSkKICB9LAogIG1ldGhvZHM6IHsKICAgIHN1Ym1pdFNldChmb3JtTmFtZSkgewogICAgICB0aGlzLiRyZWZzW2Zvcm1OYW1lXS52YWxpZGF0ZShhc3luYyByZXMgPT4gewogICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLpqozor4HpgJrov4ciKTsKICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgICAgY29kZTogdGhpcy52YWxCZWZvcmUsCiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmZvcm0ucGFzc3dvcmQsCiAgICAgICAgICAgIHBhc3N3b3JkX2NvbmZpcm1hdGlvbjogdGhpcy5mb3JtLnJlcGVhdAogICAgICAgICAgfTsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0ICgwLCBfYXBpLlNldFRyYWRlUGFzcykocGFyYW1zKTsKICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNvZGUKICAgICAgICAgIH0gPSByZXN1bHQ7CgogICAgICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0KHJlc3VsdC5tZXNzYWdlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuJHRvYXN0LnN1Y2Nlc3MoIuS6pOaYk+Wvhueggeiuvue9ruaIkOWKnyIpOwogICAgICAgICAgdGhpcy4kc3RvcmUuZGlzcGF0Y2goImN1cnJlbnQvdXBVc2VySW5mbyIpOwogICAgICAgICAgdGhpcy4kcm91dGVyLmdvKC0xKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvL+WPkemAgemqjOivgemqjOivgeeggQogICAgYXN5bmMgc2VuZEF1dGhDb2RlKCkgewogICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgc2NlbmU6IDQsCiAgICAgICAgdHlwZTogdGhpcy5jdXJyZW50LmFjY291bnQudHlwZSwKICAgICAgICBlbWFpbDogdGhpcy5jdXJyZW50LmFjY291bnQuZW1haWwsCiAgICAgICAgcGhvbmU6IHRoaXMuY3VycmVudC5hY2NvdW50LnBob25lLAogICAgICAgIHBob25lX3ByZWZpeDogdGhpcy5jdXJyZW50LmFjY291bnQucGhvbmVfcHJlZml4CiAgICAgIH07CiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0ICgwLCBfYXBpLlNlbmRDb2RlKShwYXJhbXMpOwogICAgICBjb25zdCB7CiAgICAgICAgY29kZQogICAgICB9ID0gcmVzdWx0OwoKICAgICAgaWYgKGNvZGUgIT0gMjAwKSB7CiAgICAgICAgdGhpcy4kdG9hc3QuZmFpbChyZXN1bHQubWVzc2FnZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jb3VudCA9IDYwOwogICAgICB9CiAgICB9CgogIH0KfTsKZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7"},{"version":3,"mappings":";;;;;;;;;AA0EA;;AACA;;AACA;;AACA;;eACA;EACAA;IACA;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACA;QACAA;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACAC,SADA;MAEAC,mBAFA;MAEA;MACAC,kBAHA;MAGA;MACAC,aAJA;MAIA;MACAC,QALA;MAKA;MACAC,eANA;MAOAC;QACAC,YADA;QAEAC;MAFA,CAPA;MAWAC;QACAF,WACA;UACAG,cADA;UAEAC,2BAFA;UAGAC;QAHA,CADA,EAMA;UAAAC;UAAAD;QAAA,CANA,CADA;QASAJ,SACA;UACAE,cADA;UAEAC,6BAFA;UAGAC;QAHA,CADA,EAMA;UAAAC;UAAAD;QAAA,CANA;MATA,CAXA;MA6BAE,aACA,sDADA,EAEA,iBAFA;IA7BA;EAkCA,CAlDA;;EAmDAC,YACA;EADA,CAnDA;EAsDAC;IACAb;MACA;QACA;UACAc;YACAN,iBADA;YAEAO;UAFA;;UAIA;YACAC,QADA;YAEAC,oCAFA;YAGAC;UAHA;UAKA;UACA;YAAAA;UAAA;;UACA;YACA;YACA;UACA;;UACA,gBAhBA,CAiBA;UACA;QACA,CAnBA;;QAoBAC;MACA;IACA;;EAzBA,CAtDA;;EAiFAC;IACA;IACA;EACA,CApFA;;EAqFAC;IACAC,uBACAC,wDAFA;IAGAC;EAHA,CArFA;EA0FAC;IACAC;MACA;QACA;UACAC;UACA;YACAT,oBADA;YAEAd,4BAFA;YAGAwB;UAHA;UAKA;UACAD;UACA;YAAAT;UAAA;;UACA;YACA;YACA;UACA;;UACA;UACA;UACA;QACA;MACA,CAnBA;IAoBA,CAtBA;;IAuBA;IACA;MACA;QACAF,QADA;QAEAa,+BAFA;QAGAC,iCAHA;QAIAC,iCAJA;QAKAC;MALA;MAOA;MACA;QAAAd;MAAA;;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA;;EAvCA;AA1FA,C","names":["data","callback","status","is_bind_phone","isBindPhone","valBefore","count","codeLocal","form","password","repeat","ruleForm","required","message","trigger","validator","remarkList","computed","watch","Toast","forbidClick","scene","receiver","code","next","created","components","Navigation","require","Alert","methods","submitSet","console","password_confirmation","type","email","phone","phone_prefix"],"sourceRoot":"src/views/mine/safty","sources":["trade_auth.vue"],"sourcesContent":["<template>\n  <div class=\"trade-auth\">\n    <Navigation />\n    <!-- 前置验证 -->\n    <div class=\"trade-before-auth\" v-if=\"status == 0\">\n      <h3>{{ current.account.type == 1 ? \"手机\" : \"邮箱\" }}验证码</h3>\n      <p class=\"before-remark\">为保护您的账号安全，需要登录密码进行验证</p>\n      <P-verification v-model=\"valBefore\" />\n      <p v-if=\"count == 0\" @click=\"sendAuthCode()\" class=\"send-code un-send\">\n        获取验证码\n      </p>\n      <B-data-theCountdown v-model=\"count\" v-else class=\"send-code\"\n        >{{ count }} {{ $t(\"秒后重新获取\") }}</B-data-theCountdown\n      >\n    </div>\n    <div class=\"set-trade-password\" v-else>\n      <h3>\n        {{\n          current.account.security.pay_password == 1 ? \"修改\" : \"设置\"\n        }}交易密码\n      </h3>\n      <p class=\"before-remark\">8-12位大写、小写英文字母及数字组合</p>\n      <div class=\"form-box\">\n        <el-form\n          ref=\"form\"\n          :model=\"form\"\n          :rules=\"ruleForm\"\n          label-position=\"top\"\n        >\n          <el-form-item prop=\"password\">\n            <P-input\n              title=\"交易密码\"\n              v-model=\"form.password\"\n              :show-password=\"true\"\n              placeholder=\"请输入交易密码\"\n            ></P-input>\n          </el-form-item>\n          <el-form-item prop=\"repeat\">\n            <P-input\n              v-model=\"form.repeat\"\n              title=\"确认密码\"\n              :show-password=\"true\"\n              placeholder=\"请再次输入交易密码\"\n            ></P-input>\n          </el-form-item>\n        </el-form>\n        <!-- 交易密码说明 -->\n        <div class=\"trade-remark-box\">\n          <ul>\n            <li v-for=\"(remark, index) in remarkList\" :key=\"`${index}-remark`\">\n              <p class=\"remark-point\"></p>\n              <p>{{ remark }}</p>\n            </li>\n          </ul>\n        </div>\n        <P-button type=\"primary\" class=\"btn-primary\" @click=\"submitSet('form')\"\n          >立即设置</P-button\n        >\n      </div>\n    </div>\n    <Alert\n      svg=\"\"\n      type=\"typography\"\n      title=\"提示\"\n      v-model=\"isBindPhone\"\n      @cancel=\"$router.go(-1)\"\n      @click=\"$router.push('/auth-phone')\"\n    >\n      <p>设置交易密码前需要手机认证</p>\n    </Alert>\n  </div>\n</template>\n\n<script>\nimport { Toast } from \"vant\";\nimport { checkPassword } from \"../../../utils/index\";\nimport { SendCode, VerifyCode, SetTradePass } from \"../../../api/api\";\nimport { mapState } from \"vuex\";\nexport default {\n  data() {\n    const verify_pass = (rule, value, callback) => {\n      if (!checkPassword(value)) {\n        callback(new Error(\"密码格式为8-12位大写、小写英文字母及数字组合\"));\n      } else {\n        callback();\n      }\n    };\n    const verify_repeat = (rule, value, callback) => {\n      if (value !== this.form.password) {\n        callback(new Error(\"两次输入密码不一致\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      status: 0,\n      is_bind_phone: true, //是否绑定手机号\n      isBindPhone: false, //未绑定提示\n      valBefore: \"\", //前置验证码\n      count: 0, //验证码倒计时\n      codeLocal: null,\n      form: {\n        password: \"\",\n        repeat: \"\",\n      },\n      ruleForm: {\n        password: [\n          {\n            required: true,\n            message: this.$t(\"请输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_pass, trigger: \"blur\" },\n        ],\n        repeat: [\n          {\n            required: true,\n            message: this.$t(\"请再次输入交易密码\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_repeat, trigger: \"blur\" },\n        ],\n      },\n      remarkList: [\n        \"交易密码是在交易所进行交易时需要输入密码，不同与登录密码。为确保您的财产安全，请牢记交易密码，防止丢失。\",\n        \"8-12位含大小写字母及数字。\",\n      ],\n    };\n  },\n  computed: {\n    ...mapState([\"current\"]),\n  },\n  watch: {\n    valBefore(val) {\n      if (val.length == 6) {\n        const next = async () => {\n          Toast.loading({\n            message: \"加载中...\",\n            forbidClick: true,\n          });\n          const params = {\n            scene: 4,\n            receiver: this.current.account.phone,\n            code: val,\n          };\n          const result = await VerifyCode(params);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.status = 1;\n          // setTimeout(() => {\n          // }, 2000);\n        };\n        next();\n      }\n    },\n  },\n  created() {\n    !this.current.account.phone && (this.isBindPhone = true);\n    this.current.account.phone && this.sendAuthCode();\n  },\n  components: {\n    Navigation: (resolve) =>\n      require([\"../../../components/nav/Navigation\"], resolve),\n    Alert: (resolve) => require([\"../../../components/Alert\"], resolve),\n  },\n  methods: {\n    submitSet(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          console.log(\"验证通过\");\n          const params = {\n            code: this.valBefore,\n            password: this.form.password,\n            password_confirmation: this.form.repeat,\n          };\n          const result = await SetTradePass(params);\n          console.log(result);\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.$toast.success(\"交易密码设置成功\");\n          this.$store.dispatch(\"current/upUserInfo\");\n          this.$router.go(-1);\n        }\n      });\n    },\n    //发送验证验证码\n    async sendAuthCode() {\n      const params = {\n        scene: 4,\n        type: this.current.account.type,\n        email: this.current.account.email,\n        phone: this.current.account.phone,\n        phone_prefix: this.current.account.phone_prefix,\n      };\n      const result = await SendCode(params);\n      const { code } = result;\n      if (code != 200) {\n        this.$toast.fail(result.message);\n      } else {\n        this.count = 60;\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\nh3 {\n  font-size: 22px;\n  color: #333;\n  font-weight: 500;\n}\n.before-remark {\n  font-size: 12px;\n  color: #999;\n  margin-top: 8px;\n  margin-bottom: 40px;\n}\n.trade-before-auth {\n  padding: 30px 12px;\n\n  .send-code {\n    text-align: right;\n    margin-top: 14px;\n    font-size: 14px;\n  }\n  .un-send {\n    color: #2cbc94;\n  }\n}\n.set-trade-password {\n  padding: 30px 12px;\n  /deep/.el-form-item {\n    margin-bottom: 4px;\n  }\n  .trade-remark-box {\n    padding: 12px;\n    background: #eee;\n    border-radius: 4px;\n    margin-top: 22px;\n    ul {\n      li {\n        display: flex;\n        align-items: center;\n        .remark-point {\n          min-width: 5px;\n          height: 5px;\n          border-radius: 50%;\n          background: #999;\n          margin-right: 8px;\n        }\n        p:last-child {\n          font-size: 12px;\n          color: #999;\n        }\n      }\n      li:last-child {\n        margin-top: 12px;\n      }\n    }\n  }\n  .btn-primary {\n    margin-top: 22px;\n  }\n}\n</style>"]}]}