{"remainingRequest":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js!/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js??ref--1-0!/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js??vue-loader-options!/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/email_auth.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/tql_yy/Documents/code/use_one/src/views/mine/safty/email_auth.vue","mtime":1658285989774},{"path":"/Users/tql_yy/Documents/code/use_one/babel.config.js","mtime":1657511087035},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_babel-loader@8.2.5@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/tql_yy/Documents/code/use_one/node_modules/_vue-loader@15.10.0@vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwpleHBvcnRzLmRlZmF1bHQgPSB2b2lkIDA7CgpyZXF1aXJlKCJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiKTsKCnZhciBfdnVleCA9IHJlcXVpcmUoInZ1ZXgiKTsKCnZhciBfaW5kZXggPSByZXF1aXJlKCIuLi8uLi8uLi91dGlscy9pbmRleCIpOwoKdmFyIF9hcGkgPSByZXF1aXJlKCIuLi8uLi8uLi9hcGkvYXBpIik7Cgp2YXIgX2RlZmF1bHQgPSB7CiAgZGF0YSgpIHsKICAgIGNvbnN0IHZlcmlmeV9lbWFpbCA9IChydWxlLCB2YWx1ZSwgY2FsbGJhY2spID0+IHsKICAgICAgaWYgKCEoMCwgX2luZGV4LmNoZWNrRW1haWwpKHZhbHVlKSkgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi6K+36L6T5YWl5q2j56Gu55qE6YKu566x5qC85byPIikpOwogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH07CgogICAgY29uc3QgdmVyaWZ5X2NvZGUgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICh2YWx1ZS5sZW5ndGggIT0gNikgewogICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcigi6K+36L6T5YWlNuS9jemqjOivgeeggSIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjYWxsYmFjaygpOwogICAgICB9CiAgICB9OwoKICAgIHJldHVybiB7CiAgICAgIGJlZm9yZUF1dGg6IDEsCiAgICAgIC8vIDEgLSDmnKrpqozor4EgMiAtIOW3sumqjOivgQogICAgICBlbWFpbENvZGU6ICIiLAogICAgICAvL+mCrueusemqjOivgeeggQogICAgICBhdXRoRm9ybTogewogICAgICAgIHBhc3N3b3JkOiAiIgogICAgICB9LAogICAgICBhdXRoRm9ybVJ1bGU6IHsKICAgICAgICBwYXNzd29yZDogW3sKICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgi6K+36L6T5YWl55m75b2V5a+G56CBIiksCiAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICB9XQogICAgICB9LAogICAgICBmb3JtOiB7CiAgICAgICAgZW1haWw6ICIiLAogICAgICAgIGNvZGU6ICIiCiAgICAgIH0sCiAgICAgIHJ1bGVGb3JtOiB7CiAgICAgICAgZW1haWw6IFt7CiAgICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoIuivt+i+k+WFpemCrueuseWcsOWdgCIpLAogICAgICAgICAgdHJpZ2dlcjogImJsdXIiCiAgICAgICAgfSwgewogICAgICAgICAgdmFsaWRhdG9yOiB2ZXJpZnlfZW1haWwsCiAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICB9XSwKICAgICAgICBjb2RlOiBbewogICAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCLor7fovpPlhaXpqozor4HnoIEiKSwKICAgICAgICAgIHRyaWdnZXI6ICJibHVyIgogICAgICAgIH0sIHsKICAgICAgICAgIHZhbGlkYXRvcjogdmVyaWZ5X2NvZGUsCiAgICAgICAgICB0cmlnZ2VyOiAiYmx1ciIKICAgICAgICB9XQogICAgICB9LAogICAgICBjb3VudDogMAogICAgfTsKICB9LAoKICBjb21wb25lbnRzOiB7CiAgICBOYXZpZ2F0aW9uOiByZXNvbHZlID0+IHJlcXVpcmUoWyIuLi8uLi8uLi9jb21wb25lbnRzL25hdi9OYXZpZ2F0aW9uIl0sIHJlc29sdmUpCiAgfSwKICBjb21wdXRlZDogeyAuLi4oMCwgX3Z1ZXgubWFwU3RhdGUpKFsiY3VycmVudCJdKQogIH0sCiAgbWV0aG9kczogewogICAgY2hlY2tQYXNzKGZvcm1OYW1lKSB7CiAgICAgIHRoaXMuJHJlZnNbZm9ybU5hbWVdLnZhbGlkYXRlKGFzeW5jIHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgKDAsIF9hcGkuQ2hlY2tQYXNzKSh7CiAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLmF1dGhGb3JtLnBhc3N3b3JkCiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgY29kZQogICAgICAgICAgfSA9IHJlc3VsdDsKCiAgICAgICAgICBpZiAoY29kZSAhPSAyMDApIHsKICAgICAgICAgICAgdGhpcy4kdG9hc3QocmVzdWx0Lm1lc3NhZ2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy4kdG9hc3QubG9hZGluZyh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICLliqDovb3kuK0uLi4iLAogICAgICAgICAgICBmb3JiaWRDbGljazogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmJlZm9yZUF1dGggPSAyOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8v5Y+R6YCB6aqM6K+B56CBCiAgICBhc3luYyBzZW5kQ29kZSgpIHsKICAgICAgaWYgKCF0aGlzLmZvcm0uZW1haWwpIHsKICAgICAgICB0aGlzLiR0b2FzdCgi6K+36L6T5YWl6YKu566x5Zyw5Z2AIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2luZGV4LmNoZWNrRW1haWwpKHRoaXMuZm9ybS5lbWFpbCkpIHsKICAgICAgICB0aGlzLiR0b2FzdCgi6K+36L6T5YWl5q2j56Gu55qE6YKu566x5Zyw5Z2AIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgIHNjZW5lOiAzLAogICAgICAgICAgdHlwZTogMiwKICAgICAgICAgIGVtYWlsOiB0aGlzLmZvcm0uZW1haWwKICAgICAgICB9OwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0ICgwLCBfYXBpLlNlbmRDb2RlKShwYXJhbXMpOwogICAgICAgIHRoaXMuY291bnQgPSA2MDsKICAgICAgICB0aGlzLiR0b2FzdC5zdWNjZXNzKCLpqozor4HnoIHlj5HpgIHmiJDlip8iKTsKICAgICAgICB0aGlzLmVtYWlsQ29kZSA9IHJlc3VsdC5kYXRhLmNvZGU7CiAgICAgIH0KICAgIH0sCgogICAgLy/mj5DkuqTpgq7nrrHnu5HlrpoKICAgIHN1Ym1pdEVtYWlsKGZvcm1OYW1lKSB7CiAgICAgIHRoaXMuJHJlZnNbZm9ybU5hbWVdLnZhbGlkYXRlKGFzeW5jIHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgICBlbWFpbDogdGhpcy5mb3JtLmVtYWlsLAogICAgICAgICAgICBwYXNzd29yZDogdGhpcy5hdXRoRm9ybS5wYXNzd29yZCwKICAgICAgICAgICAgY29kZTogdGhpcy5mb3JtLmNvZGUKICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoMCwgX2FwaS5CaW5kRW1haWwpKHBhcmFtcyk7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGNvZGUKICAgICAgICAgIH0gPSByZXN1bHQ7CgogICAgICAgICAgaWYgKGNvZGUgPT0gMjAwKSB7CiAgICAgICAgICAgIHRoaXMuJHRvYXN0LnN1Y2Nlc3MoIuiupOivgeaIkOWKnyIpOwogICAgICAgICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgiY3VycmVudC91cFVzZXJJbmZvIik7CiAgICAgICAgICAgIHRoaXMuJHJvdXRlci5nbygtMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgfQp9OwpleHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDs="},{"version":3,"mappings":";;;;;;;;;AAkEA;;AACA;;AACA;;eACA;EACAA;IACA;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACA;QACAA;MACA,CAFA,MAEA;QACAA;MACA;IACA,CANA;;IAOA;MACAC,aADA;MACA;MACAC,aAFA;MAEA;MACAC;QACAC;MADA,CAHA;MAMAC;QACAD,WACA;UACAE,cADA;UAEAC,2BAFA;UAGAC;QAHA,CADA;MADA,CANA;MAeAC;QACAC,SADA;QAEAC;MAFA,CAfA;MAmBAC;QACAF,QACA;UACAJ,cADA;UAEAC,2BAFA;UAGAC;QAHA,CADA,EAMA;UAAAK;UAAAL;QAAA,CANA,CADA;QASAG,OACA;UAAAL;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAK;UAAAL;QAAA,CAFA;MATA,CAnBA;MAiCAM;IAjCA;EAmCA,CAnDA;;EAoDAC;IACAC,uBACAC;EAFA,CApDA;EAwDAC,YACA;EADA,CAxDA;EA2DAC;IACAC;MACA;QACA;UACA;YAAAhB;UAAA;UACA;YAAAO;UAAA;;UACA;YACA;YACA;UACA;;UACA;YACAJ,iBADA;YAEAc;UAFA;UAIA;QACA;MACA,CAdA;IAeA,CAjBA;;IAkBA;IACA;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;QACA;MACA,CAHA,MAGA;QACA;UACAC,QADA;UAEAC,OAFA;UAGAb;QAHA;QAKA;QACA;QACA;QACA;MACA;IACA,CArCA;;IAsCA;IACAc;MACA;QACA;UACA;YACAd,sBADA;YAEAN,gCAFA;YAGAO;UAHA;UAKA;UACA;YAAAA;UAAA;;UACA;YACA;YACA;YACA;UACA;QACA;MACA,CAfA;IAgBA;;EAxDA;AA3DA,C","names":["data","callback","beforeAuth","emailCode","authForm","password","authFormRule","required","message","trigger","form","email","code","ruleForm","validator","count","components","Navigation","require","computed","methods","checkPass","forbidClick","scene","type","submitEmail"],"sourceRoot":"src/views/mine/safty","sources":["email_auth.vue"],"sourcesContent":["<!-- 邮箱认证 -->\n<template>\n  <div class=\"email-auth\">\n    <Navigation />\n    <div class=\"auth-content auth-before\" v-if=\"beforeAuth == 1\">\n      <h3>密码验证</h3>\n      <p class=\"auth-remark\">为保护您的账号安全，需要登录密码进行验证</p>\n      <el-form\n        ref=\"check\"\n        :rules=\"authFormRule\"\n        :model=\"authForm\"\n        label-position=\"top\"\n      >\n        <el-form-item prop=\"password\">\n          <P-input\n            title=\"登录密码\"\n            v-model=\"authForm.password\"\n            placeholder=\"请输入登录密码\"\n            :show-password=\"true\"\n          ></P-input>\n        </el-form-item>\n      </el-form>\n      <P-button\n        style=\"margin-top: 40px\"\n        type=\"primary\"\n        class=\"btn-primary\"\n        @click=\"checkPass('check')\"\n        >下一步</P-button\n      >\n    </div>\n    <div class=\"auth-content\" v-else>\n      <h3>邮箱{{ current.account.email ? \"修改\" : \"认证\" }}</h3>\n      <el-form :model=\"form\" ref=\"form\" :rules=\"ruleForm\" label-position=\"top\">\n        <el-form-item prop=\"email\">\n          <P-input\n            title=\"邮箱地址\"\n            v-model=\"form.email\"\n            placeholder=\"请输入邮箱地址\"\n          ></P-input>\n        </el-form-item>\n        <el-form-item prop=\"code\">\n          <P-input\n            title=\"验证码\"\n            v-model=\"form.code\"\n            placeholder=\"请输入验证码\"\n          >\n          </P-input>\n          <p class=\"send-code-text\" v-if=\"count == 0\" @click=\"sendCode\">\n            {{ $t(\"获取验证码\") }}\n          </p>\n          <B-data-theCountdown v-model=\"count\" v-else\n            >{{ count }} {{ $t(\"秒后重新获取\") }}</B-data-theCountdown\n          >\n        </el-form-item>\n      </el-form>\n      <P-button\n        type=\"primary\"\n        class=\"btn-primary h-44-i m-60-t-i\"\n        @click=\"submitEmail('form')\"\n        >提交</P-button\n      >\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\";\nimport { checkEmail } from \"../../../utils/index\";\nimport { CheckPass, SendCode, BindEmail } from \"../../../api/api\";\nexport default {\n  data() {\n    const verify_email = (rule, value, callback) => {\n      if (!checkEmail(value)) {\n        callback(new Error(\"请输入正确的邮箱格式\"));\n      } else {\n        callback();\n      }\n    };\n    const verify_code = (rule, value, callback) => {\n      if (value.length != 6) {\n        callback(new Error(\"请输入6位验证码\"));\n      } else {\n        callback();\n      }\n    };\n    return {\n      beforeAuth: 1, // 1 - 未验证 2 - 已验证\n      emailCode: \"\", //邮箱验证码\n      authForm: {\n        password: \"\",\n      },\n      authFormRule: {\n        password: [\n          {\n            required: true,\n            message: this.$t(\"请输入登录密码\"),\n            trigger: \"blur\",\n          },\n        ],\n      },\n      form: {\n        email: \"\",\n        code: \"\",\n      },\n      ruleForm: {\n        email: [\n          {\n            required: true,\n            message: this.$t(\"请输入邮箱地址\"),\n            trigger: \"blur\",\n          },\n          { validator: verify_email, trigger: \"blur\" },\n        ],\n        code: [\n          { required: true, message: this.$t(\"请输入验证码\"), trigger: \"blur\" },\n          { validator: verify_code, trigger: \"blur\" },\n        ],\n      },\n      count: 0,\n    };\n  },\n  components: {\n    Navigation: (resolve) =>\n      require([\"../../../components/nav/Navigation\"], resolve),\n  },\n  computed: {\n    ...mapState([\"current\"]),\n  },\n  methods: {\n    checkPass(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          const result = await CheckPass({ password: this.authForm.password });\n          const { code } = result;\n          if (code != 200) {\n            this.$toast(result.message);\n            return;\n          }\n          this.$toast.loading({\n            message: \"加载中...\",\n            forbidClick: true,\n          });\n          this.beforeAuth = 2;\n        }\n      });\n    },\n    //发送验证码\n    async sendCode() {\n      if (!this.form.email) {\n        this.$toast(\"请输入邮箱地址\");\n        return;\n      } else if (!checkEmail(this.form.email)) {\n        this.$toast(\"请输入正确的邮箱地址\");\n        return;\n      } else {\n        const params = {\n          scene: 3,\n          type: 2,\n          email: this.form.email,\n        };\n        const result = await SendCode(params);\n        this.count = 60;\n        this.$toast.success(\"验证码发送成功\");\n        this.emailCode = result.data.code;\n      }\n    },\n    //提交邮箱绑定\n    submitEmail(formName) {\n      this.$refs[formName].validate(async (res) => {\n        if (res) {\n          const params = {\n            email: this.form.email,\n            password: this.authForm.password,\n            code: this.form.code,\n          };\n          const result = await BindEmail(params);\n          const { code } = result;\n          if (code == 200) {\n            this.$toast.success(\"认证成功\");\n            this.$store.dispatch(\"current/upUserInfo\");\n            this.$router.go(-1);\n          }\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style lang=\"less\" scoped>\n@import url(\"./index.less\");\n.auth-before {\n  h3 {\n    margin-bottom: 0;\n  }\n}\n.auth-remark {\n  font-size: 12px;\n  color: #999;\n  margin-top: 4px;\n  margin-bottom: 38px;\n}\n</style>"]}]}